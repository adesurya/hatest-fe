<!-- views/pages/user/dashboard.ejs -->
<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %> | Organisasi Indonesia</title>
    
    <!-- Favicon -->
    <link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/user.css">
</head>
<body>
    <!-- Preloader -->
    <div id="preloader">
        <div class="spinner"></div>
    </div>
    
    <!-- User Layout -->
    <div class="user-layout">
        <!-- Sidebar -->
        <%- include('../../partials/user-sidebar') %>
        
        <!-- Main Content -->
        <div class="main-content">
            <!-- Navbar -->
            <nav class="navbar navbar-expand-lg navbar-light bg-white py-3 px-4 shadow-sm">
                <div class="d-flex align-items-center">
                    <button id="sidebarToggle" class="btn">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h5 class="mb-0 ms-3">Dashboard Anggota</h5>
                </div>
                
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <% if (user.profilePicture) { %>
                                <img src="<%= user.profilePicture %>" alt="<%= user.name %>" class="rounded-circle me-2" width="30">
                            <% } else { %>
                                <div class="avatar-placeholder rounded-circle me-2 d-inline-flex align-items-center justify-content-center bg-primary text-white" style="width: 30px; height: 30px;">
                                    <%= user.name.charAt(0).toUpperCase() %>
                                </div>
                            <% } %>
                            <%= user.name %>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown">
                            <li><a class="dropdown-item" href="/user/profile"><i class="fas fa-user me-2"></i> Profil</a></li>
                            <li><a class="dropdown-item" href="/user/change-password"><i class="fas fa-key me-2"></i> Ubah Password</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="/auth/logout"><i class="fas fa-sign-out-alt me-2"></i> Logout</a></li>
                        </ul>
                    </li>
                </ul>
            </nav>
            
            <!-- Dashboard Content -->
            <div class="content-wrapper p-4">
                <!-- Flash Messages -->
                <% if (success_msg && success_msg.length > 0) { %>
                    <div class="alert alert-success alert-dismissible fade show" role="alert">
                        <%= success_msg %>
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                <% } %>
                
                <% if (error_msg && error_msg.length > 0) { %>
                    <div class="alert alert-danger alert-dismissible fade show" role="alert">
                        <%= error_msg %>
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                <% } %>
                
                <!-- Welcome Card -->
                <div class="card welcome-card mb-4 border-0 shadow-sm">
                    <div class="card-body p-4">
                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <h4 class="mb-1">Selamat Datang, <%= user.name %>!</h4>
                                <p class="text-muted mb-3">Selamat datang di dashboard anggota Organisasi Indonesia. Di sini Anda dapat mengelola profil, memantau kegiatan, dan mengakses berbagai layanan.</p>
                                
                                <div class="mb-2">
                                    <span class="badge bg-primary me-2">Status: 
                                        <% if (dashboardData && dashboardData.membershipStatus) { %>
                                            <%= dashboardData.membershipStatus %>
                                        <% } else { %>
                                            Aktif
                                        <% } %>
                                    </span>
                                    <span class="badge bg-info">Anggota sejak: 
                                        <% if (dashboardData && dashboardData.memberSince) { %>
                                            <%= new Date(dashboardData.memberSince).toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' }) %>
                                        <% } else { %>
                                            1 Januari 2022
                                        <% } %>
                                    </span>
                                </div>
                                
                                <a href="/user/profile" class="btn btn-primary btn-sm mt-2">Lihat Profil</a>
                                <a href="#" class="btn btn-outline-primary btn-sm mt-2">Pembaruan Terbaru</a>
                            </div>
                            <div class="col-md-4 text-end d-none d-md-block">
                                <img src="/images/welcome-illustration.svg" alt="Welcome" class="welcome-illustration" width="180">
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Quick Stats Cards -->
                <div class="row g-4 mb-4">
                    <div class="col-md-4">
                        <div class="card stat-card h-100 border-0 shadow-sm">
                            <div class="card-body d-flex align-items-center">
                                <div class="icon-box bg-primary text-white me-3">
                                    <i class="fas fa-calendar-check"></i>
                                </div>
                                <div>
                                    <h6 class="text-muted mb-1">Kegiatan Diikuti</h6>
                                    <h3 class="mb-0">
                                        <% if (dashboardData && dashboardData.attendedActivities) { %>
                                            <%= dashboardData.attendedActivities %>
                                        <% } else { %>
                                            5
                                        <% } %>
                                    </h3>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <div class="card stat-card h-100 border-0 shadow-sm">
                            <div class="card-body d-flex align-items-center">
                                <div class="icon-box bg-success text-white me-3">
                                    <i class="fas fa-certificate"></i>
                                </div>
                                <div>
                                    <h6 class="text-muted mb-1">Sertifikat</h6>
                                    <h3 class="mb-0">
                                        <% if (dashboardData && dashboardData.certificates) { %>
                                            <%= dashboardData.certificates %>
                                        <% } else { %>
                                            3
                                        <% } %>
                                    </h3>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <div class="card stat-card h-100 border-0 shadow-sm">
                            <div class="card-body d-flex align-items-center">
                                <div class="icon-box bg-warning text-white me-3">
                                    <i class="fas fa-clock"></i>
                                </div>
                                <div>
                                    <h6 class="text-muted mb-1">SKP Terkumpul</h6>
                                    <h3 class="mb-0">
                                        <% if (dashboardData && dashboardData.skpPoints) { %>
                                            <%= dashboardData.skpPoints %>
                                        <% } else { %>
                                            15
                                        <% } %>
                                    </h3>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Membership Card -->
                <div class="card membership-card mb-4 border-0 shadow-sm">
                    <div class="card-header bg-white d-flex justify-content-between align-items-center">
                        <h5 class="card-title mb-0">Informasi Keanggotaan</h5>
                        <a href="/user/membership" class="btn btn-sm btn-outline-primary">Detail</a>
                    </div>
                    <div class="card-body p-4">
                        <div class="row align-items-center">
                            <div class="col-lg-3 col-md-4 mb-3 mb-md-0 text-center">
                                <div class="membership-card-container">
                                    <div class="id-card border rounded-3 p-3 bg-primary text-white overflow-hidden position-relative mx-auto" style="max-width: 300px;">
                                        <div class="org-logo mb-2">
                                            <img src="/images/logo-white.png" alt="Organization Logo" class="img-fluid" style="height: 40px;">
                                        </div>
                                        <h6 class="fw-bold mb-3">KARTU ANGGOTA</h6>
                                        <div class="member-info text-start">
                                            <p class="mb-1"><small>Nama:</small></p>
                                            <p class="fw-bold mb-2"><%= user.name %></p>
                                            <p class="mb-1"><small>No. Anggota:</small></p>
                                            <p class="fw-bold mb-2">
                                                <% if (dashboardData && dashboardData.membershipNumber) { %>
                                                    <%= dashboardData.membershipNumber %>
                                                <% } else { %>
                                                    IDI-2022-12345
                                                <% } %>
                                            </p>
                                            <p class="mb-1"><small>Berlaku Hingga:</small></p>
                                            <p class="fw-bold mb-0">
                                                <% if (dashboardData && dashboardData.validUntil) { %>
                                                    <%= new Date(dashboardData.validUntil).toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' }) %>
                                                <% } else { %>
                                                    31 Desember 2025
                                                <% } %>
                                            </p>
                                        </div>
                                        <div class="card-pattern position-absolute top-0 end-0 w-50 h-100 opacity-10"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-9 col-md-8">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label text-muted small">Nama Lengkap</label>
                                            <p class="mb-0 fw-medium"><%= user.name %></p>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label text-muted small">Email</label>
                                            <p class="mb-0 fw-medium"><%= user.email %></p>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label text-muted small">Nomor Anggota</label>
                                            <p class="mb-0 fw-medium">
                                                <% if (dashboardData && dashboardData.membershipNumber) { %>
                                                    <%= dashboardData.membershipNumber %>
                                                <% } else { %>
                                                    IDI-2022-12345
                                                <% } %>
                                            </p>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label text-muted small">Status Keanggotaan</label>
                                            <p class="mb-0">
                                                <span class="badge bg-success rounded-pill px-3">
                                                    <% if (dashboardData && dashboardData.membershipStatus) { %>
                                                        <%= dashboardData.membershipStatus %>
                                                    <% } else { %>
                                                        Aktif
                                                    <% } %>
                                                </span>
                                            </p>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label text-muted small">Cabang</label>
                                            <p class="mb-0 fw-medium">
                                                <% if (dashboardData && dashboardData.branch) { %>
                                                    <%= dashboardData.branch %>
                                                <% } else { %>
                                                    Jakarta
                                                <% } %>
                                            </p>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label text-muted small">Berlaku Hingga</label>
                                            <p class="mb-0 fw-medium">
                                                <% if (dashboardData && dashboardData.validUntil) { %>
                                                    <%= new Date(dashboardData.validUntil).toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' }) %>
                                                <% } else { %>
                                                    31 Desember 2025
                                                <% } %>
                                            </p>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="alert alert-info mt-3 mb-0">
                                    <div class="d-flex">
                                        <div class="me-3">
                                            <i class="fas fa-info-circle fa-2x"></i>
                                        </div>
                                        <div>
                                            <h6 class="alert-heading mb-1">Informasi Pembayaran Iuran</h6>
                                            <p class="mb-0">Status pembayaran Anda: <strong>
                                                <% if (dashboardData && dashboardData.paymentStatus) { %>
                                                    <%= dashboardData.paymentStatus %>
                                                <% } else { %>
                                                    Sudah Dibayar
                                                <% } %>
                                            </strong></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Upcoming Activities -->
                <div class="card mb-4 border-0 shadow-sm">
                    <div class="card-header bg-white d-flex justify-content-between align-items-center">
                        <h5 class="card-title mb-0">Kegiatan Mendatang</h5>
                        <a href="/user/activities" class="btn btn-sm btn-outline-primary">Lihat Semua</a>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-hover align-middle mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th>Kegiatan</th>
                                        <th>Tanggal</th>
                                        <th>Lokasi</th>
                                        <th>Status</th>
                                        <th>Aksi</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% if (dashboardData && dashboardData.upcomingActivities && dashboardData.upcomingActivities.length > 0) { %>
                                        <% dashboardData.upcomingActivities.forEach(activity => { %>
                                            <tr>
                                                <td>
                                                    <div class="d-flex align-items-center">
                                                        <img src="<%= activity.imageUrl %>" alt="<%= activity.title %>" class="rounded me-3" width="50">
                                                        <h6 class="mb-0"><%= activity.title %></h6>
                                                    </div>
                                                </td>
                                                <td><%= new Date(activity.date).toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' }) %></td>
                                                <td><%= activity.location %></td>
                                                <td>
                                                    <span class="badge bg-<%= activity.registered ? 'success' : 'warning' %> rounded-pill px-3">
                                                        <%= activity.registered ? 'Terdaftar' : 'Belum Terdaftar' %>
                                                    </span>
                                                </td>
                                                <td>
                                                    <% if (activity.registered) { %>
                                                        <a href="#" class="btn btn-sm btn-info me-1" data-bs-toggle="tooltip" title="Lihat Tiket"><i class="fas fa-ticket-alt"></i></a>
                                                    <% } else { %>
                                                        <a href="#" class="btn btn-sm btn-primary me-1" data-bs-toggle="tooltip" title="Daftar"><i class="fas fa-plus"></i></a>
                                                    <% } %>
                                                    <a href="#" class="btn btn-sm btn-outline-secondary" data-bs-toggle="tooltip" title="Detail"><i class="fas fa-eye"></i></a>
                                                </td>
                                            </tr>
                                        <% }); %>
                                    <% } else { %>
                                        <!-- Placeholder data if no activities -->
                                        <tr>
                                            <td>
                                                <div class="d-flex align-items-center">
                                                    <img src="/images/activity-1.jpg" alt="Seminar Nasional" class="rounded me-3" width="50">
                                                    <h6 class="mb-0">Seminar Nasional Profesionalisme</h6>
                                                </div>
                                            </td>
                                            <td>15 Mei 2025</td>
                                            <td>Jakarta</td>
                                            <td>
                                                <span class="badge bg-success rounded-pill px-3">Terdaftar</span>
                                            </td>
                                            <td>
                                                <a href="#" class="btn btn-sm btn-info me-1" data-bs-toggle="tooltip" title="Lihat Tiket"><i class="fas fa-ticket-alt"></i></a>
                                                <a href="#" class="btn btn-sm btn-outline-secondary" data-bs-toggle="tooltip" title="Detail"><i class="fas fa-eye"></i></a>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>
                                                <div class="d-flex align-items-center">
                                                    <img src="/images/activity-2.jpg" alt="Workshop" class="rounded me-3" width="50">
                                                    <h6 class="mb-0">Workshop Pengembangan Kompetensi</h6>
                                                </div>
                                            </td>
                                            <td>20 Juni 2025</td>
                                            <td>Surabaya</td>
                                            <td>
                                                <span class="badge bg-warning rounded-pill px-3">Belum Terdaftar</span>
                                            </td>
                                            <td>
                                                <a href="#" class="btn btn-sm btn-primary me-1" data-bs-toggle="tooltip" title="Daftar"><i class="fas fa-plus"></i></a>
                                                <a href="#" class="btn btn-sm btn-outline-secondary" data-bs-toggle="tooltip" title="Detail"><i class="fas fa-eye"></i></a>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>
                                                <div class="d-flex align-items-center">
                                                    <img src="/images/activity-3.jpg" alt="Kongres" class="rounded me-3" width="50">
                                                    <h6 class="mb-0">Kongres Nasional 2025</h6>
                                                </div>
                                            </td>
                                            <td>10 Juli 2025</td>
                                            <td>Bali</td>
                                            <td>
                                                <span class="badge bg-warning rounded-pill px-3">Belum Terdaftar</span>
                                            </td>
                                            <td>
                                                <a href="#" class="btn btn-sm btn-primary me-1" data-bs-toggle="tooltip" title="Daftar"><i class="fas fa-plus"></i></a>
                                                <a href="#" class="btn btn-sm btn-outline-secondary" data-bs-toggle="tooltip" title="Detail"><i class="fas fa-eye"></i></a>
                                            </td>
                                        </tr>
                                    <% } %>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Latest Certificates -->
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-white d-flex justify-content-between align-items-center">
                        <h5 class="card-title mb-0">Sertifikat Terbaru</h5>
                        <a href="/user/certificates" class="btn btn-sm btn-outline-primary">Lihat Semua</a>
                    </div>
                    <div class="card-body">
                        <div class="row g-4">
                            <% if (dashboardData && dashboardData.latestCertificates && dashboardData.latestCertificates.length > 0) { %>
                                <% dashboardData.latestCertificates.forEach(certificate => { %>
                                    <div class="col-md-4">
                                        <div class="certificate-card border rounded-3 p-3 text-center h-100">
                                            <div class="certificate-icon mb-3">
                                                <i class="fas fa-certificate fa-3x text-primary"></i>
                                            </div>
                                            <h6 class="mb-2"><%= certificate.title %></h6>
                                            <p class="small text-muted mb-3">Diterbitkan pada: <%= new Date(certificate.issuedDate).toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' }) %></p>
                                            <a href="<%= certificate.downloadUrl %>" class="btn btn-sm btn-outline-primary"><i class="fas fa-download me-1"></i> Unduh</a>
                                        </div>
                                    </div>
                                <% }); %>
                            <% } else { %>
                                <!-- Placeholder data if no certificates -->
                                <div class="col-md-4">
                                    <div class="certificate-card border rounded-3 p-3 text-center h-100">
                                        <div class="certificate-icon mb-3">
                                            <i class="fas fa-certificate fa-3x text-primary"></i>
                                        </div>
                                        <h6 class="mb-2">Seminar Nasional Profesionalisme</h6>
                                        <p class="small text-muted mb-3">Diterbitkan pada: 20 Mei 2024</p>
                                        <a href="#" class="btn btn-sm btn-outline-primary"><i class="fas fa-download me-1"></i> Unduh</a>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="certificate-card border rounded-3 p-3 text-center h-100">
                                        <div class="certificate-icon mb-3">
                                            <i class="fas fa-certificate fa-3x text-primary"></i>
                                        </div>
                                        <h6 class="mb-2">Workshop Pengembangan Kompetensi</h6>
                                        <p class="small text-muted mb-3">Diterbitkan pada: 25 Maret 2024</p>
                                        <a href="#" class="btn btn-sm btn-outline-primary"><i class="fas fa-download me-1"></i> Unduh</a>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="certificate-card border rounded-3 p-3 text-center h-100">
                                        <div class="certificate-icon mb-3">
                                            <i class="fas fa-certificate fa-3x text-primary"></i>
                                        </div>
                                        <h6 class="mb-2">Pelatihan Etika Profesional</h6>
                                        <p class="small text-muted mb-3">Diterbitkan pada: 10 Februari 2024</p>
                                        <a href="#" class="btn btn-sm btn-outline-primary"><i class="fas fa-download me-1"></i> Unduh</a>
                                    </div>
                                </div>
                            <% } %>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    <!-- Custom JS -->
    <script src="/js/user.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Sidebar Toggle
            const sidebarToggle = document.getElementById('sidebarToggle');
            const userLayout = document.querySelector('.user-layout');
            
            sidebarToggle.addEventListener('click', function() {
                userLayout.classList.toggle('sidebar-collapsed');
            });
            
            // Initialize tooltips
            const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl);
            });
        });
    </script>
</body>
</html>